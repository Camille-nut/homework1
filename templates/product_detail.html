<!-- product_detail.html -->

{% extends 'nav.html' %}
{% load static %}
{% block css %}
    <style type="text/css">
        .card-title {
            color: #000000;
        }

        .card-price {
            color: #f6d83f;
        }

        .card-stock {
            color: #9e9e9e;
        }

        #quantity {
            width: 100px;
        }

        .img-hover:hover {
            opacity: 0.8;
            transform: scale(1.1); /* 放大图片 */
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; /* 合并过渡效果 */
        }

        .img-pre {
            width: 800px;
            height: 600px;
            object-fit: cover;
            transition: transform 0.3s ease-in-out;
        }
    </style>
{% endblock %}
{% block content %}
    <div class="container mt-4">
        <div class="row shadow card">
            <div class="col-md-4" style="overflow: hidden">
                <!-- Modal -->
                {#           预览模块#}
                <div class="modal fade" id="productModal" tabindex="-1" role="dialog"
                     aria-labelledby="productModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="productModalLabel">{{ product.name }}</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <img src="{{ product.image.url }}" class="img-fluid img-pre" alt="{{ product.name }}">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Trigger/Open The Modal -->
                <a href="#" data-toggle="modal" data-target="#productModal">
                    <img src="{{ product.image.url }}" class="img-fluid img-hover" alt="{{ product.name }}">
                </a>
            </div>
            <div class="col-md-7">
                <h3 class="card-title">{{ product.name }}</h3>
                <p class="card-price">￥{{ product.price }}</p>
                <p class="card-text">{{ product.description }}</p>
                <p class="card-stock">库存：{{ product.stock }}</p>
                <form method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="quantity">数量</label>
                        <input type="number" name="quantity" id="quantity" class="form-control" value="1" min="1">
                    </div>
                    <button type="submit" class="btn btn-primary">加入购物车</button>
                    <button type="button" id="favoriteButton" class="btn btn-primary"
                            data-product-id="{{ product.id }}">
                        {% if is_favorited %}
                            <i class="fa-solid fa-heart"></i>取消收藏
                        {% else %}
                        <i class="fa-regular fa-heart"></i>收藏
                        {% endif %}
                    </button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script>
        // 假设你有一个函数来处理收藏逻辑
        function toggleFavorite(productId) {
            // 发送 AJAX 请求到服务器
            $.ajax({
                url: `/toggle_favorite/${productId}/`, // 你的 URL
                type: 'POST',
                data: {
                    'productId': productId,
                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val() // 获取 CSRF token
                },
                success: function (response) {
                    // 根据响应更新按钮状态
                    if (response.isFavorited) {
                        $('#favoriteButton').html('<i class="fa-solid fa-heart"></i>取消收藏');
                        alert('收藏成功')
                    } else {
                        $('#favoriteButton').html('<i class="fa-regular fa-heart"></i>收藏');
                        alert('取消收藏成功')
                    }
                },
                error: function () {
                    alert('收藏操作失败，请稍后再试。');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            var favoriteButton = document.getElementById('favoriteButton');

            favoriteButton.addEventListener('click', function (event) {
                // 阻止按钮的默认提交行为
                event.preventDefault();

                // 发送 AJAX 请求来处理收藏逻辑
                var productId = favoriteButton.getAttribute('data-product-id'); // 假设您有一个 data-product-id 属性
                // 这里替换为您的收藏逻辑
                toggleFavorite(productId);
            });
        });
    </script>

{% endblock %}